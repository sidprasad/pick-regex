<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PICK - Regex Builder</title>
    <link rel="stylesheet" href="<!--CSS_URI_PLACEHOLDER-->">
</head>

<body>
    <div class="container">
        <!-- Status Bar (global - shown during LLM operations) -->
        <div id="statusBar" class="status-bar hidden">
            <div id="statusMessage" class="status-message"></div>
            <div class="status-actions">
                <button id="reportIssueBtn" class="icon-btn small" title="Report an issue" aria-label="Report an issue">
                    <span class="codicon codicon-bug" aria-hidden="true"></span>
                    <span class="btn-label">Report Issue</span>
                </button>
                <button id="statusCancelBtn" class="icon-btn small stop-btn hidden" title="Cancel generation" aria-label="Cancel generation">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M7 7 L17 17 M17 7 L7 17" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                    </svg>
                </button>
            </div>
        </div>
        <!-- Initial Prompt -->




        <div id="promptSection" class="section">
  <!-- Model Selector Row -->
  <div id="modelSelectorRow" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--vscode-panel-border);">
    <label for="modelSelect" style="font-size: 12px; color: var(--vscode-descriptionForeground); white-space: nowrap;">Model:</label>
    <select id="modelSelect" style="flex: 1; padding: 4px 8px; background: var(--vscode-dropdown-background); color: var(--vscode-dropdown-foreground); border: 1px solid var(--vscode-dropdown-border); border-radius: 2px; font-size: 12px; height: 28px;">
      <option value="">Loading models...</option>
    </select>
  </div>
  
  <p style="margin: 0 0 6px 0; font-size: 1.05rem; font-weight: 500;">
    Describe what your regex should match.
  </p>

    <div style="display: flex; align-items: center; gap: 8px; margin-top: 4px;">
    <input
      type="text"
      id="promptInput"
      placeholder=""
      style="flex: 1; margin-bottom: 0;"
    />

    <button
      id="generateBtn"
      class="primary"
      style="min-width: 40px; width: 40px; margin-bottom: 0;"
      title="Generate candidate regexes"
      aria-label="Generate candidate regexes"
    >
      <svg id="generateIcon" viewBox="0 0 24 24" fill="none"
           xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
           width="16" height="16">
        <path d="M6 4l12 8-12 8V4z" fill="currentColor" />
      </svg>
    </button>

        <button id="inlineCancelBtn" class="icon-btn small stop-btn hidden" title="Cancel generation" aria-label="Cancel generation">
                <svg id="stopIcon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M7 7 L17 17 M17 7 L7 17" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
                </svg>
            </button>
  </div>
</div>


        <!-- Voting Section -->
        <div id="votingSection" class="section hidden">
            <div id="currentPromptDisplay" class="current-prompt-display"></div>
            <div style="margin-bottom: 12px;">
                <button id="startFreshBtn" class="secondary full-width">Build a New Regex</button>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h4 style="margin:0;">Should the generated regex match these words?</h4>
                <div class="display-controls" aria-hidden="false">
                    <button id="displayOptionsBtn" class="icon-btn" title="Display options" aria-haspopup="true"
                        aria-expanded="false" aria-controls="displayOptionsMenu">
                        <!-- simpler gear: use emoji for consistent rendering across themes -->
                        <span aria-hidden="true" style="font-size:16px; line-height:1;">⚙️</span>
                    </button>
                    <div id="displayOptionsMenu" class="display-menu hidden" role="menu" aria-label="Display options">
                        <label id="literalMenuRow" class="menu-row" role="menuitemcheckbox" aria-checked="true">
                            <input type="checkbox" id="literalToggle" checked
                                aria-label="Literal mode — visualize whitespace and control characters">
                            <span>Literal mode — visualize whitespace &amp; control characters</span>
                        </label>
                        <label id="diffMenuRow" class="menu-row" role="menuitemcheckbox" aria-checked="false">
                            <input type="checkbox" id="diffToggle" aria-label="Show diff between words (off by default)">
                            <span>Show diff between words</span>
                        </label>
                        <label id="showCandidatesMenuRow" class="menu-row" role="menuitemcheckbox" aria-checked="true">
                            <input type="checkbox" id="showCandidatesToggle" checked aria-label="Show candidates list">
                            <span>Show candidates list</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="word-pair" id="wordPair"></div>

            <div class="candidates-list" id="candidatesList"></div>
            <div class="word-history" id="wordHistory">
                <h3>Word Classification History</h3>
                <div id="historyItems"></div>
            </div>
        </div>

        <!-- Final Result -->
        <div id="finalSection" class="section hidden">
            <div class="final-result">
                <div id="finalPromptDisplay" class="current-prompt-display"></div>
                <h2>Final Regex</h2>
                <div class="regex-display" id="finalRegex"></div>
                <div class="examples">
                    <div class="example-box in">
                        <h3>Words IN</h3>
                        <div id="wordsIn"></div>
                    </div>
                    <div class="example-box out">
                        <h3>Words OUT</h3>
                        <div id="wordsOut"></div>
                    </div>
                </div>
                <button id="resetBtn" class="full-width">Build a New Regex</button>
            </div>
        </div>

        <!-- Error Display -->
        <div id="errorSection" class="error hidden"></div>
        
        <!-- Candidates help modal (hidden by default) -->
        <div id="candidatesHelpModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="candidatesHelpTitle">
  <div class="modal-overlay" id="candidatesHelpOverlay"></div>
  <div class="modal-content" role="document">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
      <h3 id="candidatesHelpTitle" style="margin:0;">Where do these candidates come from?</h3>
      <button id="candidatesHelpClose" class="icon-btn" title="Close">✕</button>
    </div>

    <p>These regex candidates are generated by the language model you’ve enabled in VS Code.</p>

    <p>PICK sends your description to that model and asks it to suggest several possible regex patterns.</p>

    <p>PICK then helps you choose between them by having you vote on which example strings should or should not match. As you classify examples, incompatible candidates are eliminated.</p>

    <p>If none of the candidates seem correct, we recommend refining the description above and generating a new set of options.</p>
  </div>
</div>

    </div>

    <!-- External JavaScript file -->
    <script src="<!--JS_URI_PLACEHOLDER-->"></script>
    <script>
        // Initialize the webview with the VS Code API
        const vscode = acquireVsCodeApi();
        if (window.initializePickView) {
            window.initializePickView(vscode);
        }
    </script>
</body>

</html>
